# Asymmetric gene flow maintains range edges in a marine invertebrate
GENERAL INFORMATION

This README.txt file was updated on 12/11/2025. 

A. Paper associated with this archive

Citation: REDACTED Asymmetric gene flow maintains range edges in a marine invertebrate. In review.

Brief abstract

Species are restricted to finite ranges, and when they are in demographic equilibrium with the environment this implies a failure to adapt at the range periphery. There are several competing evolutionary hypotheses for the maintenance and persistence of range edges. One hypothesis is gene swamping of edge populations, in which migrants from the center carrying alleles adapted to the range center but maladaptive along the edge hamper local adaptation. A competing explanation is dispersal limitation, in which reduced migration to the periphery keeps edge populations small, causing drift to dominate over selection. It has proven difficult to assess these potential generative scenarios due to the inherent complexity of species ranges. In this study, we leverage range-wide genomic sequencing data to investigate the evolution of range edges in an empirical system - Haustorius canadensis, the Canadian shovel bug. We find increased genetic drift and inbreeding on the range edges and detect signatures of asymmetric migration towards the range center. The inferred directionality of migration is consistent with the direction of the dominant current regimes in the North Atlantic. We conclude that anisotropic dispersal towards the range center leaves progressively fewer migrants to replenish peripheral populations, consistent with the migration limitation hypothesis, and generates the appearance of an abundant center.  

B. Originators

REDACTED

C. Contact information

REDACTED

D. Dates of data collection
May 2023

E. Geographic Location(s) of data collection
Coordinates for each site can be found in the file "revised_shovel_bug_results.txt"

F. Funding Sources
Research reported was supported by the National Institute of General Medical Sciences 
of the National Institutes of Health (NIH) under award R35GM137919 (awarded to 
GSB).

ACCESS INFORMATION

1. Licenses/restrictions: CC0 1.0 Universal (CC0 1.0) Public Domain Dedication
2. Recommended citation for this data/code archive: https://github.com/*/asym_gene_flow_proj

DATA & CODE FILE OVERVIEW

This data repository consist of 25 data files, 14 code scripts, 11 figure files, and this README document, with the following data and code filenames and variables.

Data files and variables in data folder
1. Filtered VCF file (feems_filt.recode.vcf)
Description: This file is produced from de_novo_map.sh, population_stacks.sh, and filtering_pixy.sh (to line 6). It is a file of filtered SNPs.
2. BED files (feems_bed.bed, feems_bed.bim, feems_bed.bed)
Descprition: These are BED files generated by bcftools in filtering_pixy.sh, a necessary file format for several analyses (e.g., feems, conStruct).
3. FST and geographic distance data frame (fst_dist_data.txt)
Description: This file is produced from pixy (filtering_pixy.sh, lines 56-60) combined with pairwise geographic distance for each population from new_pop_file.txt (below).
4. Location files (haust_locations.coord, haust_locations.outer)
Description: These files are used in the FEEMS analysis - the first provides the exact coordinates, the second is the outline of the inferred migration surface.
5. List of individual locations (new_indv_file.txt, new_ind_coords.txt, coords_for_psi.txt)
Description: These files are different formats of the same information - specific coordinate locations for each individual. Different formats are required for different programs, and the scripts below indicate which.
6. Population locations (new_pop_file.txt)
Description: Coordinate file for each sample site instead of individuals. 
7. Empirical psi results (psi_results.txt)
Description: This file is compiled from the results of the rangeExpansion R package. The package produces a data table of psi and heterozygosity estimates for each site; these have been manually combined into this file. 
8. Summary statistics (revised_shovel_bugs_results.txt)
Description: This file is a summary of several different analyses. It lists each individual in the first column, the sample site in the second, the clusters they were assigned by the VCF2PCACluster analysis (from filtering_pixy.sh), the first two PC axes from this analysis, coordinate locations, pi (estimated from pixy in filtering_pixy.sh), mean_depth (from vcftools, filtering_pixy.sh), F - inbreeding coefficient (vcftools, filtering_pixy.sh), low_cov_pi (pi estimated in pixy when coverage is normalized), and low_mean_depth (depth of normalized coverage). This file was manually compiled from the results of each analysis.
9. Simulated psi results (sim_psi_results.txt, center_sym_size_results.txt)
Description: These files contain the results from the SLiM simulations; the first column is the population (1-10), second is the measured heterozygosity for that population (using rangeExpansion), the next is the sum of psi (rangeExpansion), the rep (1-10), and the simulated model. To get these files, the user must first run the simulation in SLiM, parse the tree files using psi_sim_parse.py, then convert the resulting vcf files into BED files using plink (as in filtering_pixy.sh). The BED files can then be interpreted by rangeExpansion to estimate psi. This was all done manually, though a wiser coder than myself could likely write-up a clever way to automate this process.
10. FEEMS analysis results (feems_edges_revise.csv, feems_node_pos_revise.csv, feems_nodes_revise.csv, feems_w_revise.csv)
Description: Each of these files are produced from feems_script.py and convert the FEEMS results into csv files - these results include the migration weights of each edge, the specific edges and where the nodes are located, and the inferred migration rates. 
11. VCF2PCACluster results (feems_filt_struct.txt)
Description: feems_filt_struct.txt is the result of the population structure analysis on feems_filt.recode.vcf and is required for the conStruct analysis (below). 
12. conStruct analysis files (coords_new_layers.txt, shovelbugs_K2_data.block.Robj, amphipod_conStruct_infile.Robj, layer_contributions.txt)
Description: Each of these file are produced by the prep_amphipod_conStruct.R and run_amphipod_conStruct.R files. The former prepares the data for the conStruct analysis by filtering out low coverage individuals, and the latter performs and then parses the resulting Robj files. NOTE: analysis_plots.R refers to the output from this analysis - shovelbugs_K2_conStruct.results.Robj - that is not in the data folder in this repository. This is because this file is too large for github. If you follow these two conStruct scripts and the naming conventions within, it will produce this file.

Code scripts and workflow in script folder
1. Statistical analysis in R (analysis_plots.R)
2. SLiM simulation recipes (center_asym.slim, center_sym.slim, equal_asym.slim, equal_sym.slim, center_sym_size.slim)
3. Perform the feems analysis in Python (feems_script.py)
4. Bash scripts for de novo assembly and filtering (de_novo_map.sh, populations_stacks.sh)
5. Custom stacks script for handling 2RAD data, provided by J. Catchen (stacks-2.67.tar.gz)
6. Parse the simulation psi results in Python (psi_sim_parse.py)
7. Prepare data and perform conStruct analysis (prep_amphipod_conStruct.R, run_amphipod_conStruct.R)
8. Filter data for pixy (filtering_pixy.sh)

General Workflow

Results of each analysis have been summarized in data files (e.g., revised_shovel_bug_results.txt) for ease of analysis. Getting the results in these formats requires manual manipulation, but here I will describe how the user can acquire each of these results, after which they can recompile these files if they so choose.

1. I assume the user begins with an unfiltered VCF file produced from STACKS of the raw sequence reads (SRA BioProject can be found here: https://www.ncbi.nlm.nih.gov/bioproject/PRJNA1183394). The full STACKS workflow can be found here (https://catchenlab.life.illinois.edu/stacks/manual/). By default, this file is populations.snps.vcf when produced from populations_stacks.sh; filtering_pixy.sh assumes this default name is kept. 
2. Lines 6-12 of filtering_pixy.sh filter and format the VCF file. It also performs the PCA (VCF2PCACluster). These produce feems_filt.recode.vcf and the PCA values in revised_shovel_bug_results.txt. 
3. The remaining lines of filtering_pixy.sh prepare the VCF file for pixy analysis, which requires creating a file of invariant and variant sites and then merging them. This requires the tabix package and bcftools (see https://www.htslib.org/doc/tabix.html for usage information). From final_merged.vcf.gz (again, too large of a file to be included in this github), the user can perform the pixy analysis - lines 56-66. The output files will have multiple chromosomes that must be averaged to get pi; see https://pixy.readthedocs.io/en/latest/about.html for instructions.
4. Summary statistics - F, mean_depth, etc. - are obtained in vcftools (see https://vcftools.sourceforge.net/man_latest.html) and then added column by column into a single file (revised_shovel_bug_results.txt). 
5. The FEEMS analysis can now be performed on the BED files. Users can refer to https://github.com/NovembreLab/feems for installation instructions and required dependencies. Results can be formatted into csv files using the feems_script.py. NOTE: current script outputs files without the suffix "revise" as in the data folder.
6. Required files now exist to move to analysis_plots.R. This script performs the basic linear regressions, the psi analysis, and triangle plot analysis, as well as generates all the figures. Note that the psi analysis does not include each of the simulation files produced by SLiM (described below) that generate the sim_psi_results.txt and center_sym_size_results.txt files. For these, each simulation was run and the output file parsed manually following the same scheme as described above for the empirical data. Additional information on running and installing rangeExpansion for the psi analysis can be found here: https://github.com/BenjaminPeter/rangeexpansion. Note that devtools (R package) may be required to download triangulaR and rangeExpansion depending on your version of R.
7. SLiM simulation files ("recipes") are for one repetition of the model. To perform additional ones, rename the files at the bottom (e.g., "_1", "_2", etc.). These simulations produce .trees files which can only be read by pyslim and tskit, python packages, as described in psi_sim_parse.py. Update the function "tskit.load()" to match the name of the .trees file you wish to parse. This script will produce a csv file of pairwise FST, pairwise divergence (pi), and a VCF that can be converted into a BED file for psi analysis following the protocol in filtering_pixy.sh. 

SOFTWARE VERSIONS
1. STACKS v.2.67
2. vcftools v.1.16
3. pixy v.1.2.7.beta1
4. VCF2PCACluster v.1.41
5. fastSTRUCTURE v.1.0
6. conStruct v.1.0.3 (R package)
7. triangulaR v.0.0.0.9000 (R package)
8. feems v.1.0.0
9. rangeExpansion (no official release version) (R package)
10. SLiM v.4.0.1
11. pyslim v.1.0.1 (Python package)
12. tskit v.0.5.3 (Python package)
13. msprime v.1.2.0 (Python package)
14. plink v.1.9
15. R v.4.4.2
